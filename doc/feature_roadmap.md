# NCM-C 功能优化与演进规划

为了实现“快速、可视化、可交互”且“轻便简洁”的系统工具目标，NCM-C 可以在现有基础上从以下维度进行深度优化：

## 1. 交互体验优化 (Interactive)

目前程序具备基本视图切换，但缺乏深度交互。
- **列表滚动与分页**：当连接数超过终端高度时，需支持 `j/k` 或方向键滚动，确保所有连接可查。
- **实时排序**：支持按进程名、远程端口、连接时长（需记录状态变化）进行快速排序。
- **搜索与过滤**：引入 `/` 键触发搜索模式，允许用户输入关键字过滤特定进程或 IP（如 `nginx` 或 `80`）。
- **快速动作**：增加“一键断开”功能。例如选中某行按 `k` (kill) 即可发送信号终止该恶意进程（需 sudo 权限）。
- **即时查看详情**：选中某行按 `Enter` 弹出小悬浮窗，显示该进程的详细信息（启动时间、用户、命令行参数）。

## 2. 风险排查精简版 (Lightweight Security)

遵循“纯内存、零辅助文件”原则，用最少的信息实现最高的排查效率：
- **智能 IP 分类**：不再引入离线数据库。改为通过掩码快速判定 **内部 LAN/回环** vs **外部公网**，并对非 80/443 的公网连接进行醒目标记。
- **运行时会话关联**：仅在内存中维护当前会话的“短时记忆”。如果某个进程在运行期间频繁发起新连接（连接数突变），在 TUI 界面通过闪烁数字示警，退出即消失。
- **执行路径审计**：无需 MD5 校验。直接检查进程的执行路径，如果进程从 `/tmp`、`/dev/shm` 或隐藏目录（以 `.` 开头）运行且拥有网络连接，则触发“高危”标记。这直接利用系统现有信息，不产生任何副作用。
- **连接状态异常判定**：通过 `TCP_STATE` 的持续时长判定（如 `SYN_SENT` 状态持续过久，可能在进行端口扫描或遭遇拒绝服务）。

## 3. 视觉与可视化升级 (Visual)

在保持 ASCII 风格的前提下增强视觉冲击力：
- **Sparklines (微型趋势图)**：在顶部的统计看板中，用字符绘制过去 60 秒的连接数趋势图（如 `  ▃▅▇`）。
- **色彩语义强化**：
    - 使用**闪烁**或**加粗**表示极高风险的连接。
    - 对不同的协议（TCP/UDP/ICMP）使用区分度更高的色块。
- **自适应布局**：支持终端窗口缩放，自动调整列宽或隐藏非关键列（如 PID ）。

## 4. 驱动与性能演进 (Portable Drivers)

系统工具的“修养”在于低无感的资源占用。针对跨平台一致性，提出以下“原生优先”方案：
- **差异化高性能驱动**：
    - **Linux 端 (eBPF)**：利用 Linux 原生 eBPF 实现零拷贝监控，精准捕捉“闪断”连接。
    - **Windows 端 (ETW/Refined Polling)**：eBPF on Windows 目前较重（需安装驱动），应采用 Windows 原生的 **ETW (Event Tracing for Windows)** 机制或深度优化 `GetExtendedTcpTable` 的轮询间隔，以保持“零依赖”特性。
- **抽象层隔离**：在 `backend/` 下保持统一接口，针对不同平台编译不同的高效驱动模块。
- **二进制极致精简**：移除不必要的库依赖，进一步压缩体积至 150KB 以内，确保动态链接库最低限度。
- **无依赖部署**：确保在 Alpine (Linux) 或 PE (Windows) 等精简环境下也能一键运行。

## 5. 导出与分析功能

- **HTML/Markdown 报告导出**：改进现有的 `export_html` 功能，生成包含饼图和趋势图的交互式可视化诊断报告。

---

## 优先级规划 (Roadmap)

| 阶段 | 功能重点 | 目标 |
| :--- | :--- | :--- |
| **P0 (核心基础)** | 列表滚动支持、实时过滤搜索、字段排序 | 解决视角局限，实现海量连接的快速检索 |
| **P1 (风险精进)** | **执行路径审计**、异常 IP 掩码高亮、**内存连接频率示警** | 无需辅助文件，利用内存和系统信息识别高危行为 |
| **P2 (视觉交互)** | TUI 悬浮窗详情、一键 Kill 进程、顶部字符趋势图 | 强化“系统级工具”的沉浸式体验与控制力 |
| **P3 (驱动优化)** | 跨平台差异化原生驱动 (Linux eBPF / Win ETW) | 在零依赖前提下追求极致的捕捉精准度 |
